<!doctype html>
<html lang="en" translate="no">
	<head>
		<title>Bav4 WC Wrapper</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<meta charset="utf-8" />
		<meta name="google" content="notranslate" />
	</head>

	<body>
		<fieldset style="width: 100%; height: 500px">
			<bayern-atlas id="map0" l="" z="8" c="671092,5299670" r="0.5" ec_draw_tool="polygon" ec_srid="25832" ec_geometry_format="geojson">
			</bayern-atlas>
			<legend>Map 1</legend>
			<button class="zoomIn">Zoom in</button>
			<button class="zoomOut">Zoom out</button>
			<button class="modifyView">Modify map view</button>
			<select class="layer-select">
				<option selected value="luftbild_labels">Luftbild</option>
				<option value="atkis">Webkarte</option>
			</select>
			<input type="range" class="layer-opacity" min="0" max="100" value="100" step="1" />
		</fieldset>

		<fieldset style="width: 50%; height: 300px; margin-top: 25px">
			<bayern-atlas id="map1" l="atkis" z="15" c="11.31644,47.81428 "> </bayern-atlas>
			<legend>Map 2</legend>
			<button class="zoomIn">Zoom in</button>
			<button class="zoomOut">Zoom out</button>
			<button class="modifyView">Modify map view</button>
			<select class="layer-select">
				<option value="luftbild_labels">Luftbild</option>
				<option selected value="atkis">Webkarte</option>
			</select>
			<input type="range" class="layer-opacity" min="0" max="100" value="100" step="1" />
		</fieldset>

		<fieldset style="width: 100%; height: 300px; margin-top: 25px">
			<legend>Events</legend>

			<textarea
				class="output"
				style="
					width: 100%;
					height: 100%;
					background-color: darkslategray;
					color: white;
					font-family:
						Courier New,
						Courier,
						Lucida Sans Typewriter,
						Lucida Typewriter,
						monospace;
				"
			></textarea>
			<button class="clear">Clear</button>
		</fieldset>
	</body>
	<script>
		document.querySelector('.clear').addEventListener('click', () => {
			document.querySelector('.output').value = '';
		});

		window.addEventListener('baLoad', (event) => {
			const baElement = event.target;
			const baContainer = baElement.parentElement;
			const baContainerLabel = baContainer.querySelector('legend').textContent;

			if (baElement.id === 'map0') {
				baElement.addLayer('luftbild_labels');
				baElement.addLayer('803da236-15f1-4c97-91e0-73248154d381');
				baElement.addLayer('c5859de2-5f50-428a-aa63-c14e7543463f');
			}

			const printEvent = (type, payload) => {
				const textarea = document.querySelector('.output');
				textarea.value = `${document.querySelector('.output').value}\n${baContainerLabel}@${new Date().toISOString()}: "${type}" => ${JSON.stringify(payload, null, 2)}`;
				textarea.scrollTop = textarea.scrollHeight;
			};

			baContainer.querySelector('.zoomIn').addEventListener('click', () => {
				baElement.modifyView({ zoom: parseInt(baElement.getAttribute('z')) + 1 });
			});
			baContainer.querySelector('.zoomOut').addEventListener('click', () => {
				baElement.modifyView({ zoom: parseInt(baElement.getAttribute('z')) - 1 });
			});
			baContainer.querySelector('.layer-select').addEventListener('change', (event) => {
				// remove the layer on index=0
				baElement.removeLayer(baElement.layers[0]);
				// add a new layer on index=0
				baElement.addLayer(event.target.value, { zIndex: 0 });
			});
			baContainer.querySelector('.layer-opacity').addEventListener('input', (event) => {
				baElement.modifyLayer(baElement.layers[0], { opacity: event.target.value / 100 });
			});
			baContainer.querySelector('.modifyView').addEventListener('click', () => {
				switch (baElement.id) {
					case 'map0':
						baElement.modifyView({ rotation: 0 });
						break;
					case 'map1':
						baElement.modifyView({ center: [11, 48], zoom: 12 });
						break;
				}
			});
			baElement.addEventListener('baGeometryChange', (event) => {
				printEvent(event.type, event.detail);
			});
			baElement.addEventListener('baFeatureSelect', (event) => {
				printEvent(event.type, event.detail.features);
			});
			baElement.addEventListener('baChange', (event) => {
				printEvent(event.type, event.detail);
			});
		});
	</script>
	<script>
		/**
		 * Needed for e2e test
		 */
		document.querySelector('bayern-atlas').addEventListener('baLoad', (event) => {
			window.ba_wcLoaded = true;
		});
	</script>
	<script src="../wc.js" defer></script>
</html>
